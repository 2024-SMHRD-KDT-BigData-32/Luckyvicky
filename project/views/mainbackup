<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=375, user-scalable=no" />
  <title>ì°¨ë°¥</title>

  <!-- fullpage.js CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullPage.js/4.0.20/fullpage.min.css" />
  <link rel="stylesheet" href="/main.css" />
  <script defer src="../carinfo.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>

  <div class="mobile-frame">
    <div id="fullpage">
      <!-- 1. ì²« í™”ë©´ - ì°¨ëŸ‰ ì •ë³´ -->
      <div class="section">
        <div class="wrapper dashboard">
          <!-- ìƒë‹¨ ë°” -->
          <div class="top-bar">
            <!-- ìƒë‹¨ë°” ì™¼ìª½ ì•„ì´ì½˜ -->
            <div class="left">
              <button class="menu-btn">
                <img src="/icon/menu.png" />
              </button>
            </div>

            <!-- ìƒë‹¨ë°” ì¤‘ì•™ ë¡œê³  ë¶€ë¶„-->
            <div class="center-logo">
              <img src="/icon/charbob_logo.png" />
            </div>

            <!-- ìƒë‹¨ë°” ì˜¤ë¥¸ìª½ ì•„ì´ì½˜ -->
            <div class="right">
              <button id="carIconBtn" class="car_info-btn">
                <img src="/icon/car-side.png" />
              </button>
              <button class="mypage-btn" onclick="location.href='/user/mypage'">
                <img src="/icon/user.png" />
              </button>
            </div>
          </div>

          <!-- ì²«í˜ì´ì§€ ë³¸ë¬¸ -->
          <div class="car-summary">
            <h3 id="carSummaryText">
              {% if isLoggedIn %}
              {% if hasCarInfo %}
              {{ user_name }}ë‹˜ì˜ ì°¨ëŸ‰
              {% else %}
              ì°¨ëŸ‰ ë“±ë¡ì´ í•„ìš”í•©ë‹ˆë‹¤
              {% endif %}
              {% else %}
              í™˜ì˜í•©ë‹ˆë‹¤ ì°¨ë°¥ ì‹¹ì‹¹ê¹€ì¹˜
              {% endif %}
            </h3>

            <!-- <br/>
                <h2>
                    <img src="/icon/car.png" class="car-icon"/>
                    ì•„ë°˜ë–¼ (2024)
                </h2> -->
            <div class="car-header" id="carHeader">
              <img id="carImage" src="/car/{% if hasCarInfo %}{{ car_model }}1.jpg{% else %}default_car.png{% endif %}"
                alt="ì°¨ ì´ë¯¸ì§€" />
              <div class="car-header-info">
                <!-- <h2 id="carModel">{{ car_model }}</h2>
                <p id="carFuel">{{ fuel_type }}</p>
                <p id="carEfficiency">{{ fuel_efficiency }}km/L</p> -->
                {% if hasCarInfo %}
                <h2 id="carModel">{{ car_model }}</h2>
                <p id="carFuel">{{ fuel_type }}</p>
                <p id="carEfficiency">{{ fuel_efficiency }}km/L</p>
                {% else %}
                <h2 id="carModel">ì°¨ëŸ‰ ë“±ë¡í•˜ê¸°</h2>
                <p id="carFuel"></p>
                <p id="carEfficiency"></p>
                {% endif %}
              </div>
            </div>


            <!-- ğŸ“¦ HTML ì „ì²´ êµ¬ì¡° (ì°¨ëŸ‰ ì •ë³´ ì„¹ì…˜ ë‚´ë¶€ì— í¬í•¨) -->
            <div class="dashboard-section">
              <div class="dashboard-cards">
                <div class="card">ë‚˜ì˜ í‰ê·  ì—°ë¹„<br /><strong id="myAvgEfficiencyCard">-</strong></div>
                <div class="card">í‰ê·  ì£¼ìœ  ì£¼ê¸°<br /><strong id="avgIntervalCard">-</strong></div>
                <div class="card">ë§ˆì§€ë§‰ ì£¼ìœ <br /><strong id="lastRefuelDateCard">-</strong><br /><small
                    id="lastRefuelPrice">-</small></div>
              </div>

              <div class="chart-box tightest-height">
                <h4>ì´ë²ˆë‹¬ ì£¼ìœ  ê·¸ë˜í”„</h4>
                <canvas id="monthlyFuelLineChart"></canvas>
              </div>

              <div class="chart-box tightest-height">
                <h4>ìœ ê°€ ì¶”ì´</h4>
                <canvas id="nearbyPriceBarChart"></canvas>
              </div>

              <div class="chart-box tightest-height">
                <h4>ì£¼ìš” ë„ì‹œë³„ ìœ ê°€</h4>
                <canvas id="majorCityDonutChart"></canvas>
              </div>

              <div class="chart-box tightest-height">
                <h4>ê·¼ì²˜ ë„ì‹œë³„ ìœ ê°€</h4>
                <canvas id="nearbyCityDonutChart"></canvas>
              </div>
            </div>


          </div>



          <!-- ì°¨ëŸ‰ ì •ë³´ ì…ë ¥ ëª¨ë‹¬ -->
          <div id="carModal">
            <div class="modal-content">
              <h3>ì°¨ëŸ‰ ì •ë³´ ì…ë ¥</h3>
              <img id="modalCarImage" src="" alt="ì°¨ ì´ë¯¸ì§€" />

              <div id="carInfoForm">
                <select id="modalCar" name="car_model">
                  <option value="" disabled selected>ì°¨ì¢… ì„ íƒ</option>
                  <option value="Avante">2024 ì•„ë°˜ë–¼CN7</option>
                  <option value="Sorento">2024 ì˜ë Œí† </option>
                  <option value="Grandeur">2024 ê·¸ëœì €</option>
                </select>
                <select id="modalFuel" name="fuel_type">
                  <option value="" disabled selected>ìœ ì¢… ì„ íƒ</option>
                  <option value="ê°€ì†”ë¦°">íœ˜ë°œìœ </option>
                  <option value="ë””ì ¤">ê²½ìœ </option>
                </select>
                <div class="unit-group">
                  <input type="number" id="modalEfficiency" name="fuel_efficiency" placeholder="ì—°ë¹„ ì…ë ¥" />
                  <span>km/L</span>
                </div>
                <button type="button" onclick="saveCarInfo()">ì €ì¥</button>
                <button type="button" onclick="closeModal()">ë‹«ê¸°</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="section">
        <div class="wrapper">
          <h2>â›½ ìµœì €ê°€ ì£¼ìœ ì†Œ</h2>
          <p>ê´‘ì£¼ê´‘ì—­ì‹œ ë¶êµ¬ ê·¼ì²˜</p>
          <ul>
            <li>1. A ì…€í”„ì£¼ìœ ì†Œ â€“ 1,490ì›</li>
            <li>2. B GSì¹¼í…ìŠ¤ â€“ 1,520ì›</li>
            <li>3. C SKì—ë„ˆì§€ â€“ 1,540ì›</li>
          </ul>
        </div>
      </div>


      <!-- ì„¹ì…˜ 3 ë‚´ ìœ„ì¹˜ ê¸°ë°˜ ì£¼ìœ ì†Œ ì°¾ê¸°-->
      <div class="section">
        <div class="map_wrap">
          <div class="map-header">
            <!-- ìƒë‹¨ë°” ì™¼ìª½ í™ˆìœ¼ë¡œ ì´ë™ ë²„íŠ¼ ì¶”ê°€ -->
            <button class="angle_up-btn" onclick="fullpage_api.moveTo(1)">
              <img src="/icon/angle-up.png" alt="í™”ì‚´í‘œ ì•„ì´ì½˜" />
            </button>

            <div class="map-header-text">
              <h2>
                <img src="/icon/map-marker.png" alt="ìœ„ì¹˜ ì•„ì´ì½˜" class="section3-icon" />
                ë‚´ ìœ„ì¹˜ ê·¼ì²˜ ì£¼ìœ ì†Œ
              </h2>
              <p>í˜„ì¬ ìœ„ì¹˜ ê¸°ë°˜ ì„ íƒ ë°˜ê²½ ì´ë‚´ ì£¼ìœ ì†Œë¥¼ í‘œì‹œí•´ì¤ë‹ˆë‹¤.</p>
            </div>
          </div>

          <!-- ì§€ë„ div -->
          <div id="map" class="map-area"></div>

          <!-- ì§€ë„ ì•„ë˜ ì£¼ìœ ì†Œ ë¦¬ìŠ¤íŠ¸ íŒ¨ë„ -->
          <div id="stationPanel" class="station-panel">
            <div class="handle"></div>
            <!-- ê±°ë¦¬ í•„í„° ë²„íŠ¼ -->
            <div class="distance-filter">
              <label for="distanceSelect">ê±°ë¦¬</label>
              <select id="distanceSelect">
                <option value="1500">1.5km ì´ë‚´</option>
                <option value="3000" selected>3km ì´ë‚´</option>
              </select>
            </div>

            <div id="stationList" class="station-list-scroll"></div>
          </div>
        </div>
      </div>


      <!-- ì„¹ì…˜ 4 ì°¨ê³„ë¶€-->
      <div class="section">
        <div class="wrapper">
          <h2>â›½ ì°¨ê³„ë¶€</h2>
          <p>ì°¨ê³„ë¶€ ì…ë ¥</p>
        </div>
      </div>
    </div>

    <!-- í•˜ë‹¨ ê³ ì • ë„¤ë¹„ê²Œì´ì…˜ ë°”-->
    <div class="nav-buttons">
      <button onclick="fullpage_api.moveTo(2)">
        <img src="/icon/gas-pump.png" class="nav-icon" />
        ìµœì €ê°€ ë³´ê¸°
      </button>
      <button onclick="fullpage_api.moveTo(3)">
        <img src="/icon/location.png" class="nav-icon" />
        ê·¼ì²˜ ìµœì €ê°€
      </button>
      <button onclick="fullpage_api.moveTo(4)">
        <img src="/icon/calendar.png" class="nav-icon" />
        ì°¨ê³„ë¶€
      </button>
    </div>
  </div>


  <div id="toast" class="toast">ì°¨ëŸ‰ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤</div>

  <!-- fullpage.js script -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fullPage.js/4.0.20/fullpage.min.js"></script>
  <script>
    new fullpage('#fullpage', {
      autoScrolling: true,
      navigation: true,
      scrollHorizontally: false,
      licenseKey: 'gplv3-license',
      afterRender: () => {
        if (typeof updateDashboardStats === 'function') {
          updateDashboardStats();
        }
      }
    });
  </script>
  <script
    src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=e6dfab2f13622dce81330992b5eff90a&libraries=services"></script>
  <script src="/map.js"></script>


  <!-- <script>
    const carModal = document.getElementById("carModal");
    const carHeader = document.getElementById("carHeader");

    carHeader.addEventListener("click", () => {
      carModal.style.display = "block";
    });
  </script> -->
  <script>
    window.__IS_LOGGED_IN__ = "{{ isLoggedIn }}";
    window.__USER_NAME__ = "{{ user_name }}";
  </script>


  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="/main.js"></script>

</body>

</html>



.container {
    width: 100%;
    height: calc(100vh - 60px);
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  
  #calendar {
    height: 50%;
    background: #ffffff;
    padding: 8px;
    border-radius: 12px;
    box-shadow: 0 0 10px rgba(0, 123, 255, 0.15);
  }
  
  .chart-container {
    height: 24%;
    background: #ffffff;
    border-radius: 12px;
    padding: 6px;
    box-shadow: 0 0 10px rgba(0, 123, 255, 0.1);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }
  
  .chart-container canvas {
    width: 100% !important;
    height: 80% !important;
  }
  
  .chart-caption {
    font-size: 10px;
    color: #2c3e50;
    text-align: left;
    font-weight: bold;
    margin: 2px 0;
  } */
  
  /* ì°¨ê³„ë¶€ ëª¨ë‹¬ */
  .modal {
    display: none;
    position: absolute;
    top: 5%;
    left: 50%;
    transform: translateX(-50%);
    z-index: 99;
    width: 90%;
    max-width: 400px;
    background: rgba(0, 0, 0, 0.4);
    border-radius: 12px;
  }
  
  .modal-content h3 {
    font-size: 18px;
    margin-bottom: 10px;
  }
  
  .modal-buttons button {
    background: #3498db;
    color: white;
    border: none;
    padding: 10px;
    margin: 5px 0;
    font-size: 14px;
    border-radius: 8px;
    cursor: pointer;
  }
  
  /* ê·¸ë˜í”„ ì„¸ì…˜ */
  .dashboard-section {
    width: 100%;
    max-width: 375px;
    height: calc(100vh - 60px); /* íƒ­ë°”ê°€ 60pxì´ë¼ ê°€ì • */
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 0.2rem;
    padding: 0.3rem 0.3rem 0.6rem;
    box-sizing: border-box;
    justify-content: flex-start; /* âœ… space-between ì œê±° */
  }
  
  .dashboard-cards {
    display: flex;
    justify-content: space-between;
    gap: 0.3rem;
  }
  
  .card {
    background: #ffffff;
    border-radius: 10px;
    padding: 4px;
    flex: 1;
    font-size: 0.6rem;
    color: #333;
    text-align: center;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
  }
  
  .card strong {
    font-size: 0.8rem;
    color: #1e90ff;
  }
  
  .chart-box {
    background: #ffffff;
    border-radius: 10px;
    padding: 6px;
    box-shadow: 0 0 4px rgba(0, 0, 0, 0.05);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    flex: 1;  /* âœ… ê·¸ë˜í”„ ë°•ìŠ¤ë¥¼ ê· ë“±í•˜ê²Œ ë¶„ë°° */
    min-height: 12vh;  /* âœ… í•„ìš” ìµœì†Œ ë†’ì´ */
    max-height: 15.5vh;
  }
  
  .chart-box h4 {
    font-size: 0.75rem;
    margin-bottom: 2px;
    color: #333;
  }
  
  .chart-box canvas {
    width: 100% !important;
    height: 100% !important;
    max-height: 100%; /* âœ… ë¶€ëª¨ ì•ˆì—ì„œë§Œ ê·¸ë ¤ì§€ê²Œ */
  }